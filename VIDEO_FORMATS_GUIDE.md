# 视频格式指南 - YUV420p vs YUV444p

## 📚 基础知识

### 什么是YUV?

YUV是一种色彩编码方式,将图像分为:
- **Y (亮度)**: 黑白信息
- **U 和 V (色度)**: 颜色信息

人眼对亮度变化比对颜色变化更敏感,所以可以压缩色度信息来减小文件大小。

---

## 🎨 YUV420p vs YUV444p 对比

### YUV420p (4:2:0 色度采样)

**原理**: 每4个像素共享一组UV色度数据
```
Y Y Y Y    U    V
Y Y Y Y    (1)  (1)
Y Y Y Y
Y Y Y Y

16个Y亮度像素 + 1个U + 1个V = 色度压缩为原来的1/4
```

**优点**:
- ✅ **兼容性极佳**: 所有设备支持(Mac, iOS, Android, Windows, 电视)
- ✅ **文件大小小**: 比YUV444p小约33%
- ✅ **解码速度快**: 对CPU/GPU友好
- ✅ **网络流畅**: 适合在线播放和流媒体

**缺点**:
- ⚠️ 色彩精度略低(但人眼几乎看不出区别)
- ⚠️ 色度边缘可能略有模糊(仅在极端放大时可见)

**适用场景**:
- 🎬 **日常视频**: YouTube, Bilibili, 社交媒体
- 📱 **移动设备**: 手机录制和播放
- 💻 **网页视频**: 在线教育, 网站嵌入
- 📺 **电视播放**: 家庭影院, 投影仪

---

### YUV444p (4:4:4 色度采样)

**原理**: 每个像素都有独立的UV色度数据
```
Y Y Y Y    U U U U    V V V V
Y Y Y Y    U U U U    V V V V
Y Y Y Y    U U U U    V V V V
Y Y Y Y    U U U U    V V V V

16个Y + 16个U + 16个V = 无色度压缩
```

**优点**:
- ✅ **色彩保真度最高**: 完全保留原始色彩信息
- ✅ **色度边缘锐利**: 适合色键抠像(绿幕)
- ✅ **后期处理友好**: 调色、特效不损失质量
- ✅ **专业标准**: 符合广播级质量要求

**缺点**:
- ❌ **Mac/iOS不兼容**: QuickTime无法播放(会黑屏或报错)
- ❌ **文件大小大**: 比YUV420p大约50%
- ❌ **解码要求高**: 需要更强的CPU/GPU
- ❌ **网络不友好**: 上传和流媒体速度慢

**适用场景**:
- 🎥 **专业后期**: 电影制作、视频调色
- 🖼️ **色键抠像**: 绿幕/蓝幕特效制作
- 📸 **高质量存档**: 原始素材保存
- 🔬 **科学分析**: 需要精确色彩的研究

---

## 📊 性能对比表

| 特性 | YUV420p (推荐) | YUV444p (专业) |
|------|---------------|---------------|
| **Mac兼容性** | ✅ 完美支持 | ❌ 不支持 |
| **iOS兼容性** | ✅ 完美支持 | ❌ 不支持 |
| **Android兼容性** | ✅ 完美支持 | ⚠️ 部分支持 |
| **Windows兼容性** | ✅ 完美支持 | ✅ 支持 |
| **文件大小** | 📉 小 (100MB) | 📈 大 (150MB) |
| **色彩精度** | ⭐⭐⭐⭐ (95%) | ⭐⭐⭐⭐⭐ (100%) |
| **解码速度** | 🚀 快 | 🐢 慢 |
| **网络流畅度** | ✅ 流畅 | ⚠️ 卡顿 |
| **后期处理** | ⭐⭐⭐ 够用 | ⭐⭐⭐⭐⭐ 完美 |

---

## 🎯 如何选择格式?

### 使用YUV420p的情况 (90%的用户)

```
✅ 需要在Mac/iPhone上播放
✅ 发布到社交媒体(YouTube, Bilibili, 抖音)
✅ 网页嵌入播放
✅ 文件大小有限制
✅ 快速分享给他人
✅ 网络流媒体播放
```

**选择**: `video/h264-mp4` (默认格式)

---

### 使用YUV444p的情况 (10%的专业用户)

```
✅ 需要最高色彩保真度
✅ 进行后期调色处理
✅ 制作绿幕特效
✅ 专业影视制作
✅ 仅在Windows/Linux上播放
✅ 存档原始素材
```

**选择**: `video/h264-high444` (高级格式)

---

## 🔍 实际测试示例

### 测试场景: 1920x1080, 30fps, 10秒视频

```python
# YUV420p 配置
videocodec: libx264
pix_fmt: yuv420p
crf: 20
preset: medium

结果:
- 文件大小: 2.1 MB
- Mac播放: ✅ 完美
- iOS播放: ✅ 完美
- Android播放: ✅ 完美
- Windows播放: ✅ 完美
```

```python
# YUV444p 配置
videocodec: libx264
pix_fmt: yuv444p
profile: high444
crf: 20
preset: medium

结果:
- 文件大小: 3.2 MB (+52%)
- Mac播放: ❌ 黑屏/报错
- iOS播放: ❌ 无法播放
- Android播放: ⚠️ 部分设备可以
- Windows播放: ✅ 可以(需要解码器)
```

---

## 🛠️ ComfyUI节点使用指南

### 方案A: 简单模式 (推荐新手)

1. 选择format: `video/h264-mp4`
2. 其他参数保持默认
3. 点击执行

**结果**: 生成Mac兼容的高质量视频

---

### 方案B: 高级模式 (专业用户)

1. 选择format: `video/h264-advanced`
2. 设置参数:
   - `advanced_pix_fmt`: 选择 `yuv420p` 或 `yuv444p`
   - `advanced_crf`: 调整质量 (16-28)
   - `advanced_preset`: 调整速度 (medium推荐)
3. 点击执行

**注意**: 选择yuv444p会导致Mac不兼容!

---

### 方案C: 手动模式 (专家用户)

1. 选择format: `video/ffmpeg-manual`
2. 手动填写所有ffmpeg参数:
   - `ffmpeg_videocodec`: libx264
   - `ffmpeg_pix_fmt`: yuv420p
   - `ffmpeg_crf`: 20
   - `ffmpeg_preset`: medium
   - `ffmpeg_x264_params`: (可选高级参数)
3. 点击执行

**用途**: 完全自定义编码参数

---

## 💡 最佳实践建议

### 日常使用 (默认配置)

```yaml
format: video/h264-mp4
# 自动使用:
#   videocodec: libx264
#   pix_fmt: yuv420p
#   crf: 20
#   preset: medium
```

**优点**: 一键生成,兼容所有设备,质量优秀

---

### 高质量需求

```yaml
format: video/h264-mp4
quality: 95  # 提高质量参数
# 自动转换为 crf: 2 (质量更高)
```

**优点**: 在保持兼容性的前提下获得更高质量

---

### 专业后期制作

```yaml
format: video/h264-high444
advanced_pix_fmt: yuv444p
advanced_crf: 16
advanced_preset: slow
```

**注意**:
- ⚠️ 生成的视频Mac无法播放
- ⚠️ 需要转换为yuv420p才能分享
- ✅ 适合作为中间素材使用

---

## 🔄 格式转换

如果你已经有yuv444p的视频,想转换为Mac兼容格式:

```bash
ffmpeg -i input_yuv444.mp4 \
  -c:v libx264 \
  -pix_fmt yuv420p \
  -crf 20 \
  -preset medium \
  output_yuv420.mp4
```

**注意**: 转换过程会有轻微质量损失(但人眼几乎看不出)

---

## ❓ 常见问题

### Q: 为什么我的视频在Mac上显示黑屏?

**A**: 你使用了yuv444p格式。解决方法:
1. 重新导出,选择 `video/h264-mp4` 格式
2. 或者使用ffmpeg转换为yuv420p

---

### Q: YUV420p的质量够用吗?

**A**: 对于99%的场景,YUV420p完全够用:
- YouTube/Netflix等流媒体都使用YUV420p
- 蓝光电影也主要使用YUV420p
- 人眼几乎无法分辨与YUV444p的区别

---

### Q: 什么时候必须使用YUV444p?

**A**: 仅在以下场景:
- 绿幕抠像(色键需要精确色彩)
- 专业调色(需要保留最大色彩信息)
- 存档原始素材(作为后期的源文件)

---

### Q: CRF值应该设置多少?

**A**: 推荐值:
- **CRF 18-20**: 高质量,视觉无损 (推荐)
- **CRF 21-23**: 很好的质量,文件适中
- **CRF 24-28**: 可接受的质量,文件较小
- **CRF < 18**: 接近无损,文件非常大
- **CRF > 28**: 质量明显下降

---

## 📖 参考资料

- [FFmpeg官方文档 - H.264编码](https://trac.ffmpeg.org/wiki/Encode/H.264)
- [色度采样科普](https://en.wikipedia.org/wiki/Chroma_subsampling)
- [YouTube推荐的上传规格](https://support.google.com/youtube/answer/1722171)

---

**最后建议**:

🎯 **如果不确定,永远选择 YUV420p (h264-mp4格式)**

它是兼容性、质量和文件大小的最佳平衡点,适用于绝大多数场景!
